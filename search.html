<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Music Videos</title>
		<link rel="stylesheet" href="mystyle.css">
	</head>
	<body>
		<center>	
			
			<div class="page_content">
				
				<a href="index.html" ><img class="noContrast" src="logo.jpg" alt = "mVideos" ><br/></a>
				<br/>
				<div class="greyBar">
					<br/>
					<table>
						<tr>
							<b>SEARCH</b>&emsp;
						</tr>
						<tr>
							<form action="search.html">
								SEARCH 
								<input name="q" size="40" placeholder="2000+ videos to search from...">
								<input type="submit" value=">">
							</form>&emsp;
						</tr>
						<tr>
							<label class="container">Explicit
								<input type="checkbox" id="accept2" name="accept2" checked="checked">
								<span class="checkmark"></span>
							</label>&emsp;
						</tr>
						<tr>
							<label class="container">Mature
								<input type="checkbox" id="accept" name="accept" >
								<span class="checkmark"></span>
							</label>&emsp;
						</tr>
						<tr>
							<button id="btn">Filter</button>&emsp;
						</tr>
					<br/>
					<br/>
				</div>
				
				<br/>
				<table id="videos">
					<div id="searching">searching...</div>
				</table>
			</div><br/>
			<br/>
			<br/>
			<br/>
		<p id='playlist'></p>
		<br>
		<button id='playButton' onclick='play()'>Play</button>
		<br>
		<br>
		</center>
	</body>
	
	<script src="js/genres.js"></script>
	<script>

function getSecondPart(str) {
    return str.split('?q=')[1];
}
var numResults= 0;

var files = [];
var numFiles = 0;
function readTextFile(file)
{
	var data;
	fetch(file)
		.then(response => response.text())
		.then(data => updateFile(data));
	return data;
}
function updateFile(data)
{
	files.push(data);
	numFiles++;
	if(numFiles == genres.length)
		search(getSecondPart(window.location.href));
}
function readFiles()
{
	for (var j = 0 ; j < genres.length; j++) 
		readTextFile("https://mvideos-com.github.io/"+genres[j]+".html");
}
function search(query)
{
	const table = document.getElementById("videos");
	query=query.replaceAll("+"," ");
	query=query.replaceAll("%2F","/");
	query=query.replaceAll("%24","$");
	var queryWords = query.toLowerCase().split(' ');
	var c = 0;
	let row;
	for (var j = 0 ; j < genres.length; j++) 
	{
		list = files[j].split('\n');
		for(var i = 0 ; i <list.length;i++)
		{	
			var wordCounter = 0;
			for(var k = 0 ; k <queryWords.length;k++)
			{
				if(list[i].includes('target="_blank"') && list[i].toLowerCase().includes(queryWords[k]))
					wordCounter++
			}
			if(wordCounter==queryWords.length)
			{
				if(c==0)
					row= table.insertRow();
				
				let data = row.insertCell(c);
				if(list[i].includes("'explicit'") ||list[i].includes('"explicit"') )
				{
					data.classList.add('explicit');
				}
				if(list[i].includes("'mature'") ||list[i].includes('"mature"') )
				{
					data.classList.add('mature');
				}
				data.innerHTML = list[i];
				numResults++;
				c++;
				if(c>5)
					c=0;
			}
		}		
	}	
	
	document.getElementById("searching").innerHTML = "";
	document.getElementById("videos").innerHTML = numResults+" results<br/>"+document.getElementById("videos").innerHTML ;
	document.getElementById("videos").innerHTML += "</tr></tbody>";
	
	Array.prototype.forEach.call(document.getElementsByClassName("mature"), function(el) {
			el.style.visibility = "hidden";			
		});
}
readFiles();
//loadTableData();
</script>
	<script src="js/hide.js"></script>
	<script src="js/select.js"></script>
	<script src="js/sort.js"></script>
</html>

